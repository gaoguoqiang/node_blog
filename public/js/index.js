window.onload=function(){var t=new Vue,e=new Vue({el:"#conter",data:{message:"",onOff:!0,loginInfo:{username:"",password:""},regInfo:{username:"",password:"",repassword:""}},methods:{onoff:function(){this.onOff=!this.onOff,this.message=""},login:function(){$.ajax({type:"post",url:"/api/user/login",data:this.loginInfo,dataType:"json",success:function(t){e.$data.message=t.message,t.code||window.location.reload()}})},reg:function(){$.ajax({type:"post",url:"/api/user/register",data:this.regInfo,success:function(t){e.$data.message=t.message,t.code||setTimeout(function(){e.$data.message="",e.$data.onOff=!e.$data.onOff},1e3)}})},logout:function(){$.ajax({type:"get",url:"/api/user/logout",success:function(t){t.code||window.location.reload()}})}}}),a=new Vue({el:"#category",data:{name:null},methods:{getData:function(){var t=this;$.ajax({type:"post",url:"/api/category/categories",success:function(e){t.name=e.categoryName}})},show:function(e){if(e>=0)var a={id:this.name[e]._id};else var a={id:null};t.$emit("change",a)}},updated:function(){$("#category li").click(function(){$("#category li").removeClass("active"),$(this).addClass("active")})}}),n=new Vue({el:"#content",data:{content:null,page:0,pages:0,limit:0,count:0,categoryId:null,onOff:!0},methods:{getData:function(t){var e=this,a="";t?(t.page&&!t.id&&(a="/api/main/contents?page="+t.page),!t.page&&t.id&&(a="/api/main/contents?id="+t.id),t.page&&t.id&&(a="/api/main/contents?page="+t.page+"&id="+t.id),t.page||t.id||(a="/api/main/contents")):a="/api/main/contents",$.ajax({type:"post",url:a,success:function(t){e.content=t.contents,e.page=t.page,e.pages=t.pages,e.limit=t.limit,e.count=t.count}})},newTime:function(t){var e=new Date(t),a=e.getFullYear(),n=e.getMonth()+1,s=e.getDate(),o=e.getHours(),i=e.getMinutes(),c=e.getSeconds(),u=a+"年"+n+"月"+s+"日 "+o+":"+i+":"+c;return u},jump:function(e){this.onOff=!1,t.$emit("showParticular",e)}},created:function(){var e=this;t.$on("change",function(t){e.categoryId=t.id,e.getData(t),e.onOff=!0})}});new Vue({el:"#particular",data:{onOff:!1,content:{},user:{},id:"",text:"",discuss:[],page:1},computed:{discussPage:function(){return this.discuss.slice(0,3)}},methods:{getData:function(){var t=this;$.ajax({type:"post",url:"/api/main/particular",data:{id:t.id},success:function(e){t.content=e.content,t.user=e.content.user,t.discuss=e.content.discuss,console.log(t.discuss)}})},newTime:function(t){var e=new Date(t),a=e.getFullYear(),n=e.getMonth()+1,s=e.getDate(),o=e.getHours(),i=e.getMinutes(),c=e.getSeconds(),u=a+"年"+n+"月"+s+"日 "+o+":"+i+":"+c;return u},save:function(){var t=this;""==t.text||t.text.match(/^\s+$/)?alert("评论不能为空！！！"):$.ajax({type:"post",url:"/api/main/discussSave",data:{value:t.text,id:t.id},success:function(e){t.discuss=e,t.text=""}})}},beforeCreate:function(){var e=this;t.$on("showParticular",function(t){e.onOff=!0,e.id=t,e.getData()}),t.$on("change",function(t){e.onOff=!1})}});n.getData(),a.getData()};